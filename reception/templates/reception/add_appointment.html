{%extends 'account/base.html'%}
{%load static%}
{% block content %}

<div class="row no-margin-padding">
  <div class="col-md-6">
    <h3 class="block-title">Add Appointment</h3>
  </div>
  <div class="col-md-6">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="index.html">
          <span class="ti-home"></span>
        </a>
                  </li>
                  <li class="breadcrumb-item">Appointments</li>
      <li class="breadcrumb-item active">Add Appointment</li>
    </ol>
  </div>
</div>
<!-- /Page Title -->

<!-- /Breadcrumb -->
<!-- Main Content -->
<div class="container-fluid">

  <div class="row">
    <!-- Widget Item -->
    <div class="col-md-12">
      <div class="widget-area-2 proclinic-box-shadow">
        <h3 class="widget-title">Add Appointment</h3>
        {% for patient in patient %}
        <form class="form-sample" method="POST" action="{% url 'reception:add-appointment' patient.code %}" enctype="multipart/form-data">
          {% csrf_token %}
          <div class="form-row">
            <div class="form-group col-md-6">
              <label for="patient-name" class="control-label">Patient Code</label>
              <input type="text" class="form-control" name="patient" value="{{ patient.code }}" readonly="True">
            </div>
            <div class="form-group col-md-6 required" class="control-label">
              <label for="department">Department</label>
            {{ add_apptmt_form.category_select }}
            </div>
            <div class="form-group col-md-6 required" class="control-label">
              <label for="doctor-name">Doctor Name</label>
              {{ add_apptmt_form.doctor_select }}
            </div>
            <div class="form-group col-md-6 required" class="control-label">
              <label for="time-slot">Price</label>
              {{ add_apptmt_form.price_select }}
            </div>
            <!-- <div class="form-group col-md-6">
              <label for="token-number">Token Number <small>(Auto Generated)</small></label>
              <input type="text" placeholder="Token Number" class="form-control" id="token-number">
            </div><!-- TODO: remember to add a token number -->
            <div class="form-group col-md-6 mb-3">
              <button type="submit" class="btn btn-primary btn-lg">Submit</button>
            </div>
          </div>
          {% endfor %}
        </form>




                <script src="{% static 'doctor/vendor/jquery/jquery.min.js' %}"></script>

        <script>
          $('#category').change(function() {populateDoctor(this)});
          $('#id_doctor').change(function() {populatePrice(this)});
          doctors = {{ add_apptmt_form.doctors | safe }}
          categories = {{ add_apptmt_form.categories | safe}};
          prices = {{add_apptmt_form.prices | safe}};
          populateCategory();
          $("#id_doctor").empty();
          $("#id_doctor").append('<option value="" disabled selected>First select a Department</option>');
          $("#id_price").append('<option value="" disabled selected>First select a Doctor</option>');
            function populateCategory() {
              $('#category').empty();
              $("#category").append('<option value="" disabled selected>Select Department</option>');
              $.each(categories, function(v) {
              $('#category')
              .append($("<option></option>")
              .attr("value", categories[v])
              .text(categories[v]));
            });
          }

          function populateDoctor(event) {
            category = $("#category option:selected").text();
            $("#id_doctor").empty();
            $("#id_doctor").append('<option value="" disabled selected>Select your option</option>');
            for (let [b, bdoctors] of Object.entries(doctors)) {
              if (b == category) {
                //alert(b);
                for (doctor in bdoctors) {
                  $('#id_doctor')
                  .append($("<option></option>")
                  .attr("value", bdoctors[doctor])
                  .text(bdoctors[doctor]));
                }
              }
            }
          }

          // function populateDoctor() {
          //     $('#id_doctor').empty();
          //     $("#id_doctor").append('<option value="" disabled selected>Select Doctor</option>');
          //     $.each(doctors, function(v) {
          //     $('#id_doctor')
          //     .append($("<option></option>")
          //     .attr("value", doctors[v])
          //     .text(doctors[v]));
          //   });
          // }

          function populatePrice(event) {
            doctor = $("#id_doctor option:selected").text();
            $("#id_price").empty();
            $("#id_price").append('<option value="" disabled selected>Select your option</option>');
            for (let [b, bprices] of Object.entries(prices)) {
              if (b == doctor) {
                //alert(b);
                for (price in bprices) {
                  $('#id_price')
                  .append($("<option></option>")
                  .attr("value", bprices[price])
                  .text(bprices[price]));
                }
              }
            }
          }
        </script>
{% endblock %}
